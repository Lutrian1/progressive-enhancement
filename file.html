<!doctype html>
<html lang="nl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>File upload met preview / Progressive Enhancement / FDND</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <link href="assets/styles.css" rel="stylesheet">
    <style>
        form {
            display: flex;
            flex-direction: column;
            margin: 0.5em;
            max-width: 1500px;
        }
        .invoer-file {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }
        label {
            border: solid;
            border-radius: 10px;
            font-size: 1.25em;
            font-weight: 700;
            height: 20em;
            width: 100%;
            background-color: var(--green);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .fdnd-button {
            margin-top: 0.5em;
            width: 100px;
        }
        
        .preview-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview-image {
            display: none;
            object-fit: cover;
            width: 100%;
            height: 100%;
        }
        
        .preview-text {
            position: absolute;
            z-index: 1;
            pointer-events: none;
        }
        
        .preview-active .preview-image {
            display: block;
        }
    </style>
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const label = document.querySelector('label');
            const fileInput = document.getElementById('file');
            
            // Create preview structure
            const previewContainer = document.createElement('div');
            previewContainer.className = 'preview-container';
            
            const previewImage = document.createElement('img');
            previewImage.className = 'preview-image';
            
            const previewText = document.createElement('span');
            previewText.className = 'preview-text';
            previewText.textContent = 'Selecteer een afbeelding';
            
            label.innerHTML = '';
            label.appendChild(previewContainer);
            previewContainer.appendChild(previewImage);
            previewContainer.appendChild(previewText);
            
            // Reset file input value to handle same file selection
            function resetFileInput() {
                fileInput.value = '';
            }
            
            function handleFileSelection(files) {
                label.classList.remove('preview-active', 'has-preview', 'drag-over');
                
                if (files && files.length > 0) {
                    const file = files[0];
                    
                    if (file.type.startsWith('image/')) {
                        const imageUrl = URL.createObjectURL(file);
                        previewImage.onload = () => {
                            URL.revokeObjectURL(imageUrl);
                            label.classList.add('preview-active', 'has-preview');
                        };
                        previewImage.src = imageUrl;
                        resetFileInput(); // Reset after successful selection
                    }
                }
            }
            
            // Improved file input change handler
            fileInput.addEventListener('change', (event) => {
                handleFileSelection(event.target.files);
            });
            
            // Drag and drop functionality
            ['dragover', 'dragenter'].forEach(event => {
                label.addEventListener(event, (e) => {
                    e.preventDefault();
                    label.classList.add('drag-over');
                });
            });
            
            ['dragleave', 'dragend'].forEach(event => {
                label.addEventListener(event, () => {
                    label.classList.remove('drag-over');
                });
            });
            
            label.addEventListener('drop', (e) => {
                e.preventDefault();
                label.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelection(e.dataTransfer.files);
                }
            });
            
            label.addEventListener('click', () => {
                fileInput.click();
            });
        });
    </script>
</head>
<body>
    <h1>File upload met preview</h1>

    <form method="post">
        <input type="file" name="file" id="file" class="invoer-file" accept="image/*" />
        <label for="file">Selecteer een afbeelding</label>
        <button type="submit" class="fdnd-button">Uploaden</button>
    </form>

    <details open>
        <summary>Demo video</summary>
        <video src="assets/file.mp4" width="1496" height="496" controls muted autoplay loop>
            <a href="assets/file.mp4">assets/file.mp4</a>
        </video>
    </details>
</body>
</html>